<%= stylesheet_link_tag "dashboards" %>
<%= stylesheet_link_tag "forms" %>

<%= javascript_include_tag "dashboards" %>
<%= javascript_include_tag "forms" %>

<div class="row wrapper border-bottom white-bg page-heading justify-content-md-center">
    <div class="col-lg-10 text-center">
        <h1>Year <%= @year %></h1>
        <br />
        <%= form_tag admin_page_main_dashboard_path, method: :get do %>
            <div class="form-group row justify-content-md-center">
                
                <label class="col-lg-2 col-form-label"><strong>Year</strong></label>

                <div class="col-lg-3">
                    <%= select_tag :year, options_for_select([2018,2019,2020,2021,2022], @year.to_i), class: "form-control chosen-select"%>    
                </div>
                <div  class="col-lg-2">
                    <%= submit_tag "Submit", class: "btn btn-lg btn-warning"%>
                </div>
            </div>
        <% end %>
    </div>
</div>

<div class="wrapper wrapper-content">
    <!-- Accounts -->
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-content">
                    <div>
                        <span class="float-left text-right">
                        <h3 class="font-bold no-margins">
                            Accounts Overview
                        </h3>
                    </div>

                    <div class="m-t-sm">
                        <div class="row">
                            <div class="col-md-12">
                                <div>
                                    <canvas id="lineAccount" height="114"></canvas>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4">
                                <h2><%= number_with_delimiter(@new_account_total) %></h2>
                                <small><strong>New Accounts</strong></small>
                            </div>
                            <div class="col-md-4">
                                <h2><%= number_with_delimiter(@deactivated_account_total) %></h2>
                                <small><strong>Deactived Accounts</strong></small>
                            </div>
                            <div class="col-md-4">
                                <h2><%= number_with_delimiter(@account_total) %></h2>
                                <small><strong>Account Total</strong></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Keywords -->
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-content">
                    <div>
                        <span class="float-left text-right">
                        <h3 class="font-bold no-margins">
                            Keywords Overview
                        </h3>
                    </div>

                    <div class="m-t-sm">
                        <div class="row">
                            <div class="col-md-12">
                                <div>
                                    <canvas id="lineKeyword" height="114"></canvas>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4">
                                <h2><%= number_with_delimiter(@new_keyword_total) %></h2>
                                <small><strong>New Keywords</strong></small>
                            </div>
                            <div class="col-md-4">
                                <h2><%=number_with_delimiter(@new_subscribed_keyword_total) %></h2>
                                <small><strong>New Subscribed Keywords</strong></small>
                            </div>
                            <div class="col-md-4">
                                <h2><%= number_with_delimiter(@keyword_total) %></h2>
                                <small><strong>Keywords Total</strong></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Short Code / Blasts -->
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-content">
                    <div>
                        <span class="float-left text-right">
                        <h3 class="font-bold no-margins">
                            Short Code Overview
                        </h3>
                    </div>

                    <div class="m-t-sm">
                        <div class="row">
                            <div class="col-md-12">
                                <div>
                                    <canvas id="lineShort" height="114"></canvas>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4">
                                <h2><%= number_with_delimiter(@message_amount) %></h2>
                                <small><strong>Messages Sent</strong></small>
                            </div>
                            <div class="col-md-4">
                                <h2><%= number_with_delimiter(@response_amount) %></h2>
                                <small><strong>Responses</strong></small>
                            </div>
                            <div class="col-md-4">
                                <h2><%= number_with_delimiter(@message_amount + @response_amount) %></h2>
                                <small><strong>Total</strong></small>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-3">
                                <h2><%= number_with_delimiter(@blast_count) %></h2>
                                <small><strong>Blasts</strong></small>
                            </div>
                            <div class="col-md-3">
                                <h2><%= number_with_delimiter(@blast_avg_rate) %></h2>
                                <small><strong>Blast Average Rate</strong></small>
                            </div>
                            <div class="col-md-3">
                                <h2><%= number_with_delimiter(@blast_avg_contact_count) %></h2>
                                <small><strong>Blast Average Contact Count</strong></small>
                            </div>
                            <div class="col-md-3">
                                <h5>SMS/MMS</h5>
                                <canvas id="doughnutChart2" width="90" height="90" style="margin: 18px auto 0"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Income -->
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-content">
                    <div>
                        <span class="float-left text-right">
                        <h3 class="font-bold no-margins">
                            Income Overview
                        </h3>
                    </div>

                    <div class="m-t-sm">
                        <div class="row">
                            <div class="col-md-12">
                                <div>
                                    <canvas id="lineIncome" height="114"></canvas>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4">
                                <h2><%= number_to_currency(@total_charged) %></h2>
                                <small><strong>Total Charged</strong></small>
                            </div>
                            <div class="col-md-4">
                                <h2><%= number_to_currency(@total_refunded) %></h2>
                                <small><strong>Total Refunded</strong></small>
                            </div>
                            <div class="col-md-4">
                                <h2><%= number_to_currency(@total_net) %></h2>
                                <small><strong>Total Net</strong></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<br />
<br />

<% content_for :javascript do %>

<script type="text/javascript">

$(function() {

    var doughnutData = {
        labels: ["SMS","MMS"],
        datasets: [{
            data: [<%= @sms_count %>, <%= @mms_count %>],
            backgroundColor: ["#3AC1CC", "#F78E28"]
        }]
    };

     var doughnutOptions = {
        responsive: false,
        legend: {
            display: false
        }
    };


    var ctx5 = document.getElementById("doughnutChart2").getContext("2d");
    new Chart(ctx5, {type: 'doughnut', data: doughnutData, options: doughnutOptions});

    // $("span.pie").peity("pie", {
    //     fill: ['#3AC1CC', '#d7d7d7', '#ffffff']
    // })

    // var d1 = [[1262304000000, 6], [1264982400000, 3057], [1267401600000, 20434], [1270080000000, 31982], [1272672000000, 26602], [1275350400000, 27826], [1277942400000, 24302], [1280620800000, 24237], [1283299200000, 21004], [1285891200000, 12144], [1288569600000, 10577], [1291161600000, 10295]];
    // var d2 = [[1262304000000, 5], [1264982400000, 200], [1267401600000, 1605], [1270080000000, 6129], [1272672000000, 11643], [1275350400000, 19055], [1277942400000, 30062], [1280620800000, 39197], [1283299200000, 37000], [1285891200000, 27000], [1288569600000, 21000], [1291161600000, 17000]];

    // var data1 = [
    //     { label: "Messages", data: d1, color: '#17a084' },
    //     { label: "Responses", data: d2, color: '#127e68' },
    // ];
  

    var lineDataAccount = {
        labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        datasets: [
            {
                label: "New Accounts",
                backgroundColor: "rgba(58,193,204,0.5)",
                borderColor: "rgba(58,193,204,0.7)",
                pointBackgroundColor: "rgba(58,193,204,1)",
                pointBorderColor: "#fff",
                data: <%= @new_accounts_by_month %>
            },
            {
                label: "Deactivated Accounts",
                backgroundColor: "rgba(219,30,54,0.5)",
                borderColor: "rgba(219,30,54,1)",
                pointBackgroundColor: "rgba(219,30,54,1)",
                pointBorderColor: "#fff",
                data: <%= @deactivated_accounts_by_month %>
            },
            {
                label: "Total",
                backgroundColor: "rgba(247,142,40,0.5)",
                borderColor: "rgba(247,142,40,1)",
                pointBackgroundColor: "rgba(247,142,40,1)",
                pointBorderColor: "#fff",
                data: <%= @total_accounts_by_month %>
            }
        ]
    };

    var lineOptions = {
        responsive: true
    };


    var ctx = document.getElementById("lineAccount").getContext("2d");
    new Chart(ctx, {type: 'line', data: lineDataAccount, options:lineOptions});

    var lineDataKeyword = {
        labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        datasets: [
            {
                label: "New Keywords",
                backgroundColor: "rgba(58,193,204,0.5)",
                borderColor: "rgba(58,193,204,0.7)",
                pointBackgroundColor: "rgba(58,193,204,1)",
                pointBorderColor: "#fff",
                data: <%= @new_keywords_by_month %>
            },
            {
                label: "New Subscribed Keywords",
                backgroundColor: "rgba(219,30,54,0.5)",
                borderColor: "rgba(219,30,54,1)",
                pointBackgroundColor: "rgba(219,30,54,1)",
                pointBorderColor: "#fff",
                data: <%= @new_subscribed_keywords_by_month %>
            },
            {
                label: "Total",
                backgroundColor: "rgba(247,142,40,0.5)",
                borderColor: "rgba(247,142,40,1)",
                pointBackgroundColor: "rgba(247,142,40,1)",
                pointBorderColor: "#fff",
                data: <%= @total_keywords_by_month %>
            }
        ]
    };

    var ctx2 = document.getElementById("lineKeyword").getContext("2d");
    new Chart(ctx2, {type: 'line', data: lineDataKeyword, options:lineOptions});

    var lineDataShort = {
        labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        datasets: [
            {
                label: "Messages",
                backgroundColor: "rgba(58,193,204,0.5)",
                borderColor: "rgba(58,193,204,0.7)",
                pointBackgroundColor: "rgba(58,193,204,1)",
                pointBorderColor: "#fff",
                data: <%= @messages_by_month %>
            },
            {
                label: "Responses",
                backgroundColor: "rgba(219,30,54,0.5)",
                borderColor: "rgba(219,30,54,1)",
                pointBackgroundColor: "rgba(219,30,54,1)",
                pointBorderColor: "#fff",
                data: <%= @responses_by_month %>
            },
            {
                label: "Total",
                backgroundColor: "rgba(247,142,40,0.5)",
                borderColor: "rgba(247,142,40,1)",
                pointBackgroundColor: "rgba(247,142,40,1)",
                pointBorderColor: "#fff",
                data: <%= @total_messages_by_month %>
            }
        ]
    };

    var ctx3 = document.getElementById("lineShort").getContext("2d");
    new Chart(ctx3, {type: 'line', data: lineDataShort, options:lineOptions});

    var lineIncome = {
        labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        datasets: [
            {
                label: "Charged Amount",
                backgroundColor: "rgba(58,193,204,0.5)",
                borderColor: "rgba(58,193,204,0.7)",
                pointBackgroundColor: "rgba(58,193,204,1)",
                pointBorderColor: "#fff",
                data: <%= @income_by_month %>
            },
            {
                label: "Refunds",
                backgroundColor: "rgba(219,30,54,0.5)",
                borderColor: "rgba(219,30,54,1)",
                pointBackgroundColor: "rgba(219,30,54,1)",
                pointBorderColor: "#fff",
                data: <%= @refund_by_month %>
            },
            {
                label: "Total",
                backgroundColor: "rgba(247,142,40,0.5)",
                borderColor: "rgba(247,142,40,1)",
                pointBackgroundColor: "rgba(247,142,40,1)",
                pointBorderColor: "#fff",
                data: <%= @total_by_month %>
            }
        ]
    };

    var lineIncomeChart = document.getElementById("lineIncome").getContext("2d");
    new Chart(lineIncomeChart, {type: 'line', data: lineIncome, options:lineOptions});


});


</script>

<% end %>